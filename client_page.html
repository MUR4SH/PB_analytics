<html>
<style>
.pb_map_span{
    opacity:0;
    font-family: 'Proxima';
    font-size: 18px;
    display: block;
    position: relative;
    text-align: center;
    top: -50px;
    background:radial-gradient(55.15% 528.85% at 50% 50%, green 0%, rgba(252, 85, 0, 0) 64.27%);
    color:white;
    padding-top:10px;
    padding-bottom:10px;
}
.map{
    transform: rotate3d(0,1,0,90deg);
    transition: transform 1s;
}
    .map_pb_obs{
        /*border: 4px solid gray;*/
        opacity:0;
        width:152px;
        height:213px;
        border-radius:10px;
        margin-left:31px;
        margin-right:31px;
        object-fit:cover;
    }
    #pb_rows_maps_last{
        padding-left:45px;
    }
</style>
<body>
    <div style='display:flex;flex-direction:row;position: absolute;right: 0px;left: 0px;bottom: 0px;'>
        <div id='pb_rows_maps_a' style='display:flex;flex-direction:row; margin-left: auto; margin-right: auto; width:auto; height:288px;'></div>
    </div>
</body>
<script>
const socket = new WebSocket('ws://localhost:8080');
let id=0;
let maps=[];
let buf=[];
let gt='Bo1';
let check = false;

function start(){
    document.getElementById('pb_rows_maps_a').innerHTML = null;
    for(let i=0;i<7;i++){
        document.getElementById('pb_rows_maps_a').innerHTML+='<div class="map" id="map_div_'+i+'"><img id="'+(i+1)+'_obs" class="map_pb_obs"></img><span class="pb_map_span" id="'+(i+1)+'_obs_span"></span></div>';
    }
}

start();

function maps_check(arr_maps){
    let real=0
    let nr = 0
    for(let i=0;i<maps.length-1;i++){
        if(maps[i]) real++;
        for(let j=i+1;j<arr_maps.length;j++){
            if(maps[i] == arr_maps[j]){
                nr++;
            }
        }
    }
    return (real == nr)
}

function get_websocket(){
    socket.send("get_lobby_info");
}

socket.onmessage = (event)=>{
        let message = event.data;
        let arr = message?JSON.parse(message):[];
                if(arr){
                    if(!arr.maps){
                        maps = [];
                        if(check) start();
                        check = false;
                    }else{
                        if(maps_check(arr.maps) && (gt == arr.game_type)){
                            check = true;
                            return
                        }else{
                            maps = arr.maps;
                        }
                        check = true;
                    }
                }else{
                    maps = [];
                    if(check)start();
                    check = false;
                }
                //start();
                if(!arr){return;}
                gt = arr.game_type;
                switch(gt){
                    case 'Bo1':
                        for(let i=0;i<maps.length;i++){
                            if(maps[i]){
                                document.getElementById((i+1)+'_obs').style='opacity:1;';
                                if(i!=3){
                                    document.getElementById((i+1)+'_obs_span').style='background:radial-gradient(55.15% 528.85% at 50% 50%, #FC5500 0%, rgba(252, 85, 0, 0) 64.27%); opacity: 1';
                                }else{
                                    document.getElementById((i+1)+'_obs_span').style='background:radial-gradient(55.15% 528.85% at 50% 50%, green 0%, rgba(252, 85, 0, 0) 64.27%); opacity: 1';
                                }
                                document.getElementById((i+1)+'_obs').src = "../maps/"+maps[i]+".map.jpg";
                                document.getElementById((i+1)+'_obs_span').innerText = maps[i];
                                document.getElementById('map_div_'+i).style='transform:rotate3d(0,1,0,0deg); transition: transform 1s;';
                            }
                        }
                        break;
                    case 'Bo3':
                        for(let i=0;i<maps.length;i++){
                            if(maps[i] != buf[i]){
                                document.getElementById((i+1)+'_obs').style='opacity:1;';
                                if(i==0 || i==2 || i==4 || i==6){
                                    document.getElementById((i+1)+'_obs_span').style='background:radial-gradient(55.15% 528.85% at 50% 50%, #FC5500 0%, rgba(252, 85, 0, 0) 64.27%); opacity: 1';
                                }else{
                                    document.getElementById((i+1)+'_obs_span').style='background:radial-gradient(55.15% 528.85% at 50% 50%, green 0%, rgba(252, 85, 0, 0) 64.27%); opacity: 1';
                                }
                                document.getElementById((i+1)+'_obs').src = "../maps/"+maps[i]+".map.jpg";
                                document.getElementById((i+1)+'_obs_span').innerText = maps[i];
                                document.getElementById('map_div_'+i).style='transform:rotate3d(0,1,0,0deg); transition: transform 1s;';
                            }
                        }
                        break;
                    case 'Bo5':
                        for(let i=0;i<maps.length;i++){
                            if(maps[i]){
                                document.getElementById((i+1)+'_obs').style='opacity:1;';
                                if(i==0 || i==6){
                                    document.getElementById((i+1)+'_obs_span').style='background:radial-gradient(55.15% 528.85% at 50% 50%, #FC5500 0%, rgba(252, 85, 0, 0) 64.27%); opacity: 1';
                                }else{
                                    document.getElementById((i+1)+'_obs_span').style='background:radial-gradient(55.15% 528.85% at 50% 50%, green 0%, rgba(252, 85, 0, 0) 64.27%); opacity: 1';
                                }
                                document.getElementById((i+1)+'_obs').src = "../maps/"+maps[i]+".map.jpg";
                                document.getElementById((i+1)+'_obs_span').innerText = maps[i];
                                document.getElementById('map_div_'+i).style='transform:rotate3d(0,1,0,0deg); transition: transform 1s;';
                            }
                        }
                        break;
                }
                if(maps.length==0){
                    buf = maps;
                }
                if(maps.length!=buf.length){
                    for(let i=0;i<maps.length;i++){
                        buf[i]=maps[i];
                    }
                }
    }

//get_lobby()
get_websocket()
setInterval(()=>{
    get_websocket()
},1000)
</script>
</html>
